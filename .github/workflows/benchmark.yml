name: CI

on:
  push:
    branches:
      - master
      - 'v*' # older version branches
    tags:
      - '*'
  pull_request:

jobs:
  benchmark:
    name: Benchmark
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2.3.4
    - uses: actions/setup-node@v2.4.1
      with:
        node-version: 16.x

    - name: Install dependencies
      run: yarn install

    - name: Build
      run: yarn build

    - name: Run perf:benchmark script
      uses: actions/github-script@v5
      env:
        HEAD_SHA: ${{ needs.pr-metadata.outputs.head_sha }}
      with:
        script: |
          let description = 'hello world'
          const { owner, repo } = context.repo
          console.log(github.repos.createCommitStatus)
          await github.repos.createCommitStatus({
            description,
            owner,
            repo,
            sha: process.env.HEAD_SHA,
            state: 'success'
          })
